<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> | UrsaMU Documentation</title>
  <meta name="description" content="Learn how to configure UrsaMU plugins and make your plugins configurable">
  <link rel="stylesheet" href="/ursamu/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ursamu.github.io/ursamu/plugins/configuration/">
<meta name="twitter:card" content="summary">
</head>
<body class="flex flex-col min-h-screen">
  
  <header class="border-b border-[var(--color-border)] py-4 sticky top-0 bg-[var(--color-bg)]/80 backdrop-blur-sm z-50">
    <div class="container mx-auto px-6 flex justify-between items-center">
      <a href="/ursamu/" class="text-lg font-bold tracking-tighter hover:text-purple-400 transition-colors">
        UrsaMU
      </a>
      
      <nav class="hidden md:flex gap-8 text-sm font-medium text-[var(--color-text-muted)]">
        
          <a href="/ursamu/" class="hover:text-white transition-colors">
            Home
          </a>
        
          <a href="/ursamu/guides/" class="hover:text-white transition-colors">
            Guides
          </a>
        
          <a href="/ursamu/configuration/" class="hover:text-white transition-colors">
            Configuration
          </a>
        
          <a href="/ursamu/api/" class="hover:text-white transition-colors">
            API Reference
          </a>
        
          <a href="/ursamu/plugins/" class="hover:text-white transition-colors">
            Plugins
          </a>
        
          <a href="/ursamu/development/" class="hover:text-white transition-colors">
            Development
          </a>
        
      </nav>
      
      <div class="flex items-center gap-4">
        <a href="https://github.com/ursamu/ursamu" class="text-[var(--color-text-muted)] hover:text-white transition-colors" title="GitHub">
          <svg class="w-5 h-5 fill-current" viewbox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
        </a>
      </div>
    </div>
  </header>

  <main class="flex-grow py-16">
    <div class="container mx-auto px-6">
      <div class="prose prose-invert max-w-4xl mx-auto">
        <h1>Plugin Configuration</h1>
<p>This guide explains how to configure UrsaMU plugins and how to make your own plugins configurable.</p>
<h2>Plugin Configuration Basics</h2>
<p>UrsaMU plugins can define their own configuration options, which can be set in the server’s configuration file. This allows server administrators to customize the behavior of plugins without modifying the plugin code.</p>
<h3>Configuration Location</h3>
<p>Plugin configurations are stored in the main UrsaMU configuration file (<code>config/config.json</code>) under the <code>plugins</code> key:</p>
<pre class="language-json" tabindex="0"><code class="language-json">{
  "server": {
    "port": 4201
  },
  "plugins": {
    "my-plugin": {
      "option1": "value1",
      "option2": 42,
      "nestedOption": {
        "subOption1": true,
        "subOption2": "hello"
      }
    },
    "another-plugin": {
      "enabled": true,
      "timeout": 5000
    }
  }
}
</code></pre>
<h3>Default Configuration</h3>
<p>Plugins should always provide default values for their configuration options. This ensures that the plugin will work correctly even if the administrator doesn’t specify any configuration.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">class MyPlugin implements IPlugin {
  name = "my-plugin";
  version = "1.0.0";
  description = "An example plugin";
  author = "Your Name";
  
  // Default configuration
  config = {
    option1: "default",
    option2: 0,
    nestedOption: {
      subOption1: false,
      subOption2: "default"
    }
  };
  
  // ...
}
</code></pre>
<h2>Configuration Schema</h2>
<p>It’s a good practice to define a TypeScript interface for your plugin’s configuration. This provides type safety and makes it easier to understand what configuration options are available.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Define the configuration interface
interface MyPluginConfig {
  option1: string;
  option2: number;
  nestedOption: {
    subOption1: boolean;
    subOption2: string;
  };
}

class MyPlugin implements IPlugin {
  name = "my-plugin";
  version = "1.0.0";
  description = "An example plugin";
  author = "Your Name";
  
  // Default configuration with type
  config: MyPluginConfig = {
    option1: "default",
    option2: 0,
    nestedOption: {
      subOption1: false,
      subOption2: "default"
    }
  };
  
  // ...
}
</code></pre>
<h3>Configuration Validation</h3>
<p>You can validate the configuration in your plugin’s <code>onInit</code> method to ensure that all required options are present and have valid values:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Validate configuration
  if (typeof this.config.option1 !== 'string') {
    console.error(`[${this.name}] Configuration error: option1 must be a string`);
    // Set a default value
    this.config.option1 = "default";
  }
  
  if (typeof this.config.option2 !== 'number' || this.config.option2 &lt; 0) {
    console.error(`[${this.name}] Configuration error: option2 must be a non-negative number`);
    // Set a default value
    this.config.option2 = 0;
  }
  
  // Continue with initialization
  // ...
}
</code></pre>
<h2>Accessing Configuration</h2>
<h3>In Your Plugin</h3>
<p>You can access your plugin’s configuration through the <code>config</code> property:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Access configuration values
  const option1 = this.config.option1;
  const option2 = this.config.option2;
  
  console.log(`Plugin configured with option1=${option1}, option2=${option2}`);
  
  // Use configuration values
  if (this.config.nestedOption.subOption1) {
    // Do something if subOption1 is true
  }
}
</code></pre>
<h3>Dynamic Configuration</h3>
<p>You can also create methods to access configuration values dynamically:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Get a configuration value with a default fallback
getConfig&lt;T&gt;(key: string, defaultValue: T): T {
  const keys = key.split('.');
  let value: any = this.config;
  
  for (const k of keys) {
    if (value === undefined || value === null) {
      return defaultValue;
    }
    value = value[k];
  }
  
  return value !== undefined ? value : defaultValue;
}

// Example usage
onInit(app: App): void {
  const value1 = this.getConfig('option1', 'fallback');
  const value2 = this.getConfig('nestedOption.subOption1', false);
  
  console.log(`Values: ${value1}, ${value2}`);
}
</code></pre>
<h2>Configuration UI</h2>
<p>For more complex plugins, you might want to provide a web-based configuration UI. UrsaMU provides hooks to add configuration pages to the admin interface.</p>
<h3>Registering a Configuration Page</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Register a configuration page
  app.admin.registerConfigPage({
    plugin: this.name,
    title: "My Plugin Settings",
    description: "Configure the My Plugin settings",
    route: "/admin/config/my-plugin",
    component: "MyPluginConfig", // Name of your component
    order: 100 // Display order in the menu
  });
  
  // Register the component
  app.admin.registerComponent("MyPluginConfig", {
    template: `
      &lt;div class="config-page"&gt;
        &lt;h1&gt;My Plugin Configuration&lt;/h1&gt;
        &lt;form @submit.prevent="saveConfig"&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="option1"&gt;Option 1&lt;/label&gt;
            &lt;input type="text" id="option1" v-model="config.option1"&gt;
          &lt;/div&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="option2"&gt;Option 2&lt;/label&gt;
            &lt;input type="number" id="option2" v-model="config.option2"&gt;
          &lt;/div&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="subOption1"&gt;Sub Option 1&lt;/label&gt;
            &lt;input type="checkbox" id="subOption1" v-model="config.nestedOption.subOption1"&gt;
          &lt;/div&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="subOption2"&gt;Sub Option 2&lt;/label&gt;
            &lt;input type="text" id="subOption2" v-model="config.nestedOption.subOption2"&gt;
          &lt;/div&gt;
          &lt;button type="submit" class="btn btn-primary"&gt;Save&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    `,
    data() {
      return {
        config: JSON.parse(JSON.stringify(app.config.plugins[this.name] || {}))
      };
    },
    methods: {
      async saveConfig() {
        try {
          await app.config.setPluginConfig(this.name, this.config);
          app.admin.showNotification("Configuration saved successfully", "success");
        } catch (error) {
          app.admin.showNotification(`Error saving configuration: ${error.message}`, "error");
        }
      }
    }
  });
}
</code></pre>
<h2>Best Practices</h2>
<h3>Configuration Naming</h3>
<p>Use clear, descriptive names for your configuration options. Avoid abbreviations and use camelCase for consistency.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Good
config = {
  maxPlayers: 100,
  defaultWelcomeMessage: "Welcome to the game!",
  enableAdvancedFeatures: false
};

// Bad
config = {
  max_plrs: 100,
  def_msg: "Welcome to the game!",
  adv: false
};
</code></pre>
<h3>Documentation</h3>
<p>Document your configuration options thoroughly, both in your code and in your plugin’s documentation. Include:</p>
<ul>
<li>What each option does</li>
<li>The expected type and format</li>
<li>Any constraints (min/max values, allowed strings, etc.)</li>
<li>The default value</li>
</ul>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">/**
 * Configuration for the MyPlugin plugin.
 * 
 * @property {string} option1 - Description of option1. Default: "default"
 * @property {number} option2 - Description of option2. Must be &gt;= 0. Default: 0
 * @property {Object} nestedOption - Nested configuration options
 * @property {boolean} nestedOption.subOption1 - Description of subOption1. Default: false
 * @property {string} nestedOption.subOption2 - Description of subOption2. Default: "default"
 */
config = {
  option1: "default",
  option2: 0,
  nestedOption: {
    subOption1: false,
    subOption2: "default"
  }
};
</code></pre>
<h3>Sensitive Information</h3>
<p>Avoid storing sensitive information (like API keys, passwords, etc.) directly in the configuration. Instead, use environment variables or a separate secure storage mechanism.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Get API key from environment variable, with config as fallback
  this.apiKey = Deno.env.get("MY_PLUGIN_API_KEY") || this.config.apiKey;
  
  if (!this.apiKey) {
    console.error(`[${this.name}] No API key provided. Plugin will not function correctly.`);
  }
}
</code></pre>
<h3>Configuration Changes</h3>
<p>If your plugin needs to respond to configuration changes at runtime, you can register a hook for the <code>config:change</code> event:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Register a hook for configuration changes
  app.hooks.on('config:change', (data) =&gt; {
    if (data.plugin === this.name) {
      console.log(`Configuration for ${this.name} changed`);
      // Update internal state based on new configuration
      this.updateInternalState();
    }
  });
}

updateInternalState(): void {
  // Update any internal state that depends on configuration
  this.someFeatureEnabled = this.config.enableSomeFeature;
  
  // Restart services if needed
  if (this.service) {
    this.service.stop();
    this.service.start(this.config.serviceOptions);
  }
}
</code></pre>
<h2>Examples</h2>
<h3>Simple Plugin Configuration</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin } from "ursamu";

interface GreeterConfig {
  message: string;
  showTimestamp: boolean;
  delay: number;
}

export default class GreeterPlugin implements IPlugin {
  name = "greeter";
  version = "1.0.0";
  description = "Greets players when they connect";
  author = "Your Name";
  
  config: GreeterConfig = {
    message: "Welcome to the game!",
    showTimestamp: true,
    delay: 1000
  };
  
  private connectHandler: (player: any) =&gt; void;
  
  onInit(app: App): void {
    this.connectHandler = (player) =&gt; {
      setTimeout(() =&gt; {
        let greeting = this.config.message;
        
        if (this.config.showTimestamp) {
          const timestamp = new Date().toLocaleTimeString();
          greeting = `[${timestamp}] ${greeting}`;
        }
        
        player.send(`|c${greeting}|n`);
      }, this.config.delay);
    };
    
    app.hooks.on('player:connect', this.connectHandler);
    
    console.log(`${this.name} initialized with message: "${this.config.message}"`);
  }
  
  onLoad(app: App): void {
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    app.hooks.off('player:connect', this.connectHandler);
    console.log(`${this.name} unloaded`);
  }
}
</code></pre>
<h3>Complex Plugin Configuration</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin } from "ursamu";

interface DiscordIntegrationConfig {
  enabled: boolean;
  token: string;
  channels: {
    general: string;
    announcements: string;
    admin: string;
  };
  prefix: string;
  syncRoles: boolean;
  roleMapping: Record&lt;string, string&gt;;
  messageOptions: {
    showPlayerName: boolean;
    showTimestamp: boolean;
    embedColor: string;
  };
}

export default class DiscordIntegrationPlugin implements IPlugin {
  name = "discord-integration";
  version = "1.0.0";
  description = "Integrates UrsaMU with Discord";
  author = "Your Name";
  
  config: DiscordIntegrationConfig = {
    enabled: false,
    token: "",
    channels: {
      general: "",
      announcements: "",
      admin: ""
    },
    prefix: "!",
    syncRoles: false,
    roleMapping: {},
    messageOptions: {
      showPlayerName: true,
      showTimestamp: true,
      embedColor: "#0099ff"
    }
  };
  
  private client: any = null;
  
  onInit(app: App): void {
    // Validate configuration
    if (this.config.enabled) {
      if (!this.config.token) {
        console.error(`[${this.name}] Discord token is required when enabled`);
        this.config.enabled = false;
      }
      
      if (!this.config.channels.general) {
        console.error(`[${this.name}] General channel ID is required`);
        this.config.enabled = false;
      }
    }
    
    // Register commands
    app.commands.register("discord-integration", {
      name: "discord",
      pattern: "discord *",
      flags: "connected",
      exec: (ctx) =&gt; {
        const args = ctx.args.trim();
        
        if (!args) {
          return ctx.send(`
            |cDiscord Integration Help|n
            discord status - Show Discord connection status
            discord link - Link your Discord account
            discord unlink - Unlink your Discord account
          `);
        }
        
        if (args === "status") {
          const status = this.client ? "connected" : "disconnected";
          ctx.send(`Discord integration is ${this.config.enabled ? 'enabled' : 'disabled'} and ${status}.`);
        }
        
        // Other command handlers...
      }
    });
    
    console.log(`${this.name} initialized`);
  }
  
  onLoad(app: App): void {
    if (this.config.enabled) {
      this.startDiscordClient(app);
    }
    
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    if (this.client) {
      this.client.destroy();
      this.client = null;
    }
    
    console.log(`${this.name} unloaded`);
  }
  
  startDiscordClient(app: App): void {
    // Implementation of Discord client initialization
    console.log(`Starting Discord client with token: ${this.config.token.substring(0, 5)}...`);
    
    // In a real implementation, you would initialize the Discord.js client here
    this.client = {
      destroy: () =&gt; console.log("Discord client destroyed")
    };
    
    // Register hooks for sending messages to Discord
    app.hooks.on('channel:message', (data) =&gt; {
      if (this.config.enabled &amp;&amp; this.client) {
        // Send channel messages to Discord
        console.log(`Would send message to Discord: ${data.message}`);
      }
    });
  }
}
</code></pre>
<p>By following these guidelines, you can create plugins with flexible, well-documented configuration options that make your plugins more useful and adaptable to different UrsaMU installations.</p>

      </div>
    </div>
  </main>

  <footer class="border-t border-[var(--color-border)] py-12 text-sm text-[var(--color-text-muted)]">
    <div class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
      <div>
        © 2025 UrsaMU Team. Built with Lume.
      </div>
      <div class="flex gap-8">
        <a href="/ursamu/guides/installation" class="hover:text-white transition-colors">Installation</a>
        <a href="/ursamu/api" class="hover:text-white transition-colors">API</a>
        <a href="/ursamu/plugins" class="hover:text-white transition-colors">Plugins</a>
      </div>
    </div>
  </footer>



</body></html>