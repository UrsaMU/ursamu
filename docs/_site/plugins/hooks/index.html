<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> | UrsaMU Documentation</title>
  <meta name="description" content="Learn how to use hooks in UrsaMU plugins to respond to events">
  <link rel="stylesheet" href="/ursamu/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ursamu.github.io/ursamu/plugins/hooks/">
<meta name="twitter:card" content="summary">
</head>
<body class="bg-ursamu-bg text-gray-200 min-h-screen flex flex-col font-sans">
  
  <header class="sticky top-0 z-50 backdrop-blur-md bg-ursamu-bg/80 border-b border-ursamu-primary/30">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <a href="/ursamu/" class="flex items-center gap-3 group">
        <img src="/ursamu/assets/logo.png" alt="UrsaMU Logo" class="h-10 w-auto rounded border border-ursamu-accent/50 group-hover:scale-105 transition-transform">
        <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-ursamu-accent to-purple-400">
          UrsaMU
        </span>
      </a>
      
      <nav class="hidden md:flex gap-6">
        
          <a href="/ursamu/" class="hover:text-ursamu-accent transition-colors font-medium">
            Home
          </a>
        
          <a href="/ursamu/guides/" class="hover:text-ursamu-accent transition-colors font-medium">
            Guides
          </a>
        
          <a href="/ursamu/configuration/" class="hover:text-ursamu-accent transition-colors font-medium">
            Configuration
          </a>
        
          <a href="/ursamu/api/" class="hover:text-ursamu-accent transition-colors font-medium">
            API Reference
          </a>
        
          <a href="/ursamu/plugins/" class="hover:text-ursamu-accent transition-colors font-medium">
            Plugins
          </a>
        
          <a href="/ursamu/development/" class="hover:text-ursamu-accent transition-colors font-medium">
            Development
          </a>
        
      </nav>
      
      <div class="flex items-center gap-4">
        <a href="https://github.com/ursamu/ursamu" class="p-2 rounded-full hover:bg-ursamu-primary/50 transition-colors" title="GitHub Repository">
          <svg class="w-6 h-6 fill-current" viewbox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
        </a>
      </div>
    </div>
  </header>

  <main class="flex-grow container mx-auto px-4 py-12">
    <div class="prose prose-invert prose-purple max-w-none">
      <h1>Plugin Hooks</h1>
<p>Hooks are a powerful feature of UrsaMU’s plugin system that allow plugins to respond to events that occur in the game. This guide explains how to use hooks in your plugins.</p>
<h2>Understanding Hooks</h2>
<p>Hooks in UrsaMU work on an event-based system. The core server and other plugins emit events at specific points in their execution, and your plugin can register listeners for these events. When an event occurs, all registered listeners are called in the order they were registered.</p>
<h3>Hook Registration</h3>
<p>To register a hook in your plugin, use the <code>app.hooks.on</code> method in your plugin’s <code>onInit</code> or <code>onLoad</code> method:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Register a hook for the 'player:connect' event
  app.hooks.on('player:connect', (player) =&gt; {
    console.log(`Player ${player.name} connected!`);
  });
}
</code></pre>
<h3>Hook Priorities</h3>
<p>You can specify a priority for your hook to control the order in which hooks are executed:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Register a hook with high priority (will run before hooks with lower priority)
app.hooks.on('player:connect', (player) =&gt; {
  console.log(`Player ${player.name} connected!`);
}, 100);

// Register a hook with low priority (will run after hooks with higher priority)
app.hooks.on('player:connect', (player) =&gt; {
  console.log(`This will run after the high priority hook`);
}, 10);
</code></pre>
<p>Higher priority values run first. The default priority is 50.</p>
<h3>Async Hooks</h3>
<p>Hooks can be asynchronous, allowing you to perform async operations:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">app.hooks.on('player:connect', async (player) =&gt; {
  // Perform some async operation
  await someAsyncFunction();
  console.log(`Player ${player.name} connected!`);
});
</code></pre>
<h2>Available Hooks</h2>
<p>UrsaMU provides many built-in hooks that your plugins can use. Here are the most commonly used hooks:</p>
<h3>Player Hooks</h3>
<table>
<thead>
<tr>
<th>Hook Name</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>player:connect</code></td>
<td>Fired when a player connects</td>
<td><code>player: Player</code></td>
</tr>
<tr>
<td><code>player:disconnect</code></td>
<td>Fired when a player disconnects</td>
<td><code>player: Player</code></td>
</tr>
<tr>
<td><code>player:create</code></td>
<td>Fired when a new player is created</td>
<td><code>player: Player</code></td>
</tr>
<tr>
<td><code>player:destroy</code></td>
<td>Fired when a player is deleted</td>
<td><code>player: Player</code></td>
</tr>
<tr>
<td><code>player:command</code></td>
<td>Fired when a player enters a command</td>
<td><code>player: Player, command: string</code></td>
</tr>
<tr>
<td><code>player:look</code></td>
<td>Fired when a player looks at something</td>
<td><code>player: Player, target: GameObject</code></td>
</tr>
</tbody>
</table>
<h3>Room Hooks</h3>
<table>
<thead>
<tr>
<th>Hook Name</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>room:enter</code></td>
<td>Fired when a player enters a room</td>
<td><code>player: Player, room: Room</code></td>
</tr>
<tr>
<td><code>room:leave</code></td>
<td>Fired when a player leaves a room</td>
<td><code>player: Player, room: Room</code></td>
</tr>
<tr>
<td><code>room:create</code></td>
<td>Fired when a new room is created</td>
<td><code>room: Room</code></td>
</tr>
<tr>
<td><code>room:destroy</code></td>
<td>Fired when a room is deleted</td>
<td><code>room: Room</code></td>
</tr>
</tbody>
</table>
<h3>Object Hooks</h3>
<table>
<thead>
<tr>
<th>Hook Name</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>object:create</code></td>
<td>Fired when a new object is created</td>
<td><code>object: GameObject</code></td>
</tr>
<tr>
<td><code>object:destroy</code></td>
<td>Fired when an object is deleted</td>
<td><code>object: GameObject</code></td>
</tr>
<tr>
<td><code>object:attribute:set</code></td>
<td>Fired when an attribute is set on an object</td>
<td><code>object: GameObject, key: string, value: any</code></td>
</tr>
<tr>
<td><code>object:attribute:get</code></td>
<td>Fired when an attribute is retrieved from an object</td>
<td><code>object: GameObject, key: string, value: any</code></td>
</tr>
</tbody>
</table>
<h3>System Hooks</h3>
<table>
<thead>
<tr>
<th>Hook Name</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>system:startup</code></td>
<td>Fired when the server starts up</td>
<td>None</td>
</tr>
<tr>
<td><code>system:shutdown</code></td>
<td>Fired when the server is shutting down</td>
<td>None</td>
</tr>
<tr>
<td><code>system:reload</code></td>
<td>Fired when the server is reloaded</td>
<td>None</td>
</tr>
<tr>
<td><code>system:error</code></td>
<td>Fired when a system error occurs</td>
<td><code>error: Error</code></td>
</tr>
</tbody>
</table>
<h3>Database Hooks</h3>
<table>
<thead>
<tr>
<th>Hook Name</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>db:save</code></td>
<td>Fired when an object is saved to the database</td>
<td><code>object: GameObject</code></td>
</tr>
<tr>
<td><code>db:load</code></td>
<td>Fired when an object is loaded from the database</td>
<td><code>object: GameObject</code></td>
</tr>
</tbody>
</table>
<h2>Creating Custom Hooks</h2>
<p>Your plugins can also create and emit custom hooks for other plugins to use. This is a powerful way to make your plugin extensible.</p>
<h3>Emitting Hooks</h3>
<p>To emit a custom hook, use the <code>app.hooks.emit</code> method:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Emit a custom hook with data
app.hooks.emit('my-plugin:custom-event', { data: 'some data' });
</code></pre>
<h3>Naming Conventions</h3>
<p>When creating custom hooks, it’s a good practice to prefix the hook name with your plugin name to avoid conflicts:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Good - prefixed with plugin name
app.hooks.emit('dice-roller:roll-result', { dice: 3, sides: 6, result: 14 });

// Bad - generic name could conflict with other plugins
app.hooks.emit('roll-result', { dice: 3, sides: 6, result: 14 });
</code></pre>
<h2>Best Practices</h2>
<h3>Hook Performance</h3>
<p>Hooks are powerful but can impact performance if overused. Follow these guidelines:</p>
<ol>
<li><strong>Be Selective</strong>: Only register hooks for events your plugin actually needs to respond to.</li>
<li><strong>Keep Handlers Fast</strong>: Hook handlers should execute quickly to avoid slowing down the server.</li>
<li><strong>Use Async Carefully</strong>: Async hooks don’t block the server, but they can lead to race conditions if not handled properly.</li>
</ol>
<h3>Error Handling</h3>
<p>Always include error handling in your hook handlers:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">app.hooks.on('player:connect', (player) =&gt; {
  try {
    // Your hook logic here
  } catch (error) {
    console.error(`Error in player:connect hook: ${error.message}`);
  }
});
</code></pre>
<h3>Cleanup</h3>
<p>When your plugin is unloaded, make sure to remove any hooks it registered:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Store a reference to the hook handler
  this.connectHandler = (player) =&gt; {
    console.log(`Player ${player.name} connected!`);
  };
  
  // Register the hook
  app.hooks.on('player:connect', this.connectHandler);
}

onUnload(app: App): void {
  // Remove the hook when the plugin is unloaded
  app.hooks.off('player:connect', this.connectHandler);
}
</code></pre>
<h2>Examples</h2>
<h3>Welcome Message Plugin</h3>
<p>This plugin sends a welcome message to players when they connect:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin, Player } from "ursamu";

export default class WelcomePlugin implements IPlugin {
  name = "welcome";
  version = "1.0.0";
  description = "Sends welcome messages to players";
  author = "Your Name";
  
  // Store hook handlers for cleanup
  private connectHandler: (player: Player) =&gt; void;
  
  config = {
    message: "Welcome to the game! Type 'help' for assistance."
  };
  
  onInit(app: App): void {
    // Create the connect handler
    this.connectHandler = (player) =&gt; {
      // Send the welcome message after a short delay
      setTimeout(() =&gt; {
        player.send(`|c${this.config.message}|n`);
      }, 1000);
    };
    
    // Register the hook
    app.hooks.on('player:connect', this.connectHandler);
    
    console.log(`${this.name} initialized`);
  }
  
  onLoad(app: App): void {
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    // Clean up hooks
    app.hooks.off('player:connect', this.connectHandler);
    console.log(`${this.name} unloaded`);
  }
}
</code></pre>
<h3>Command Logger Plugin</h3>
<p>This plugin logs all commands entered by players:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin, Player } from "ursamu";

export default class CommandLoggerPlugin implements IPlugin {
  name = "command-logger";
  version = "1.0.0";
  description = "Logs all commands entered by players";
  author = "Your Name";
  
  private commandHandler: (player: Player, command: string) =&gt; void;
  
  onInit(app: App): void {
    this.commandHandler = (player, command) =&gt; {
      // Don't log passwords
      if (command.startsWith("connect") || command.startsWith("create") || command.startsWith("password")) {
        console.log(`${player.name} entered a sensitive command`);
      } else {
        console.log(`${player.name} entered command: ${command}`);
      }
    };
    
    // Register with high priority to ensure it runs before command processing
    app.hooks.on('player:command', this.commandHandler, 100);
    
    console.log(`${this.name} initialized`);
  }
  
  onLoad(app: App): void {
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    app.hooks.off('player:command', this.commandHandler);
    console.log(`${this.name} unloaded`);
  }
}
</code></pre>
<h3>Custom Hook Example</h3>
<p>This plugin creates a custom weather system with hooks that other plugins can use:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin } from "ursamu";

export default class WeatherPlugin implements IPlugin {
  name = "weather";
  version = "1.0.0";
  description = "Adds a weather system with custom hooks";
  author = "Your Name";
  
  private weatherTypes = ["sunny", "cloudy", "rainy", "stormy", "snowy"];
  private currentWeather = "sunny";
  private weatherInterval: number;
  
  onInit(app: App): void {
    // Register weather command
    app.commands.register("weather", {
      name: "weather",
      pattern: "weather",
      flags: "connected",
      exec: (ctx) =&gt; {
        ctx.send(`The current weather is ${this.currentWeather}.`);
      }
    });
    
    console.log(`${this.name} initialized`);
  }
  
  onLoad(app: App): void {
    // Start the weather cycle
    this.startWeatherCycle(app);
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    // Stop the weather cycle
    clearInterval(this.weatherInterval);
    console.log(`${this.name} unloaded`);
  }
  
  startWeatherCycle(app: App): void {
    // Change weather every 30 minutes
    this.weatherInterval = setInterval(() =&gt; {
      const oldWeather = this.currentWeather;
      
      // Choose a new weather type
      let newWeather = oldWeather;
      while (newWeather === oldWeather) {
        newWeather = this.weatherTypes[Math.floor(Math.random() * this.weatherTypes.length)];
      }
      
      this.currentWeather = newWeather;
      
      // Emit a custom hook for the weather change
      app.hooks.emit('weather:change', {
        oldWeather,
        newWeather,
        timestamp: new Date()
      });
      
      // Announce the weather change to all players
      app.players.broadcast(`The weather has changed from ${oldWeather} to ${newWeather}.`);
      
    }, 30 * 60 * 1000); // 30 minutes
  }
}
</code></pre>
<p>Other plugins can then hook into the weather system:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// In another plugin
onInit(app: App): void {
  // React to weather changes
  app.hooks.on('weather:change', (data) =&gt; {
    console.log(`Weather changed from ${data.oldWeather} to ${data.newWeather}`);
    
    // Do something based on the new weather
    if (data.newWeather === "stormy") {
      app.players.broadcast("Thunder booms in the distance!");
    }
  });
}
</code></pre>
<p>By using hooks effectively, you can create plugins that interact with each other and with the core server in powerful ways.</p>

    </div>
  </main>

  <footer class="bg-ursamu-bg border-t border-ursamu-primary/30 py-8">
    <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
      <div class="text-sm opacity-60">
        © 2025 UrsaMU Team. Built with Lume.
      </div>
      <div class="flex gap-6 text-sm">
        <a href="/guides/installation" class="hover:text-ursamu-accent">Installation</a>
        <a href="/api" class="hover:text-ursamu-accent">API</a>
        <a href="/plugins" class="hover:text-ursamu-accent">Plugins</a>
      </div>
    </div>
  </footer>



</body></html>