<!DOCTYPE html>
<html lang="en" class="dark"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UrsaMU Documentation</title>
  <meta name="description" content="Learn how to use the database in UrsaMU plugins">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/prism.css">
  <meta name="theme-color" content="#0f172a">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ursamu.github.io/plugins/database/">
<meta name="twitter:card" content="summary">
</head>
<body class="min-h-screen flex flex-col bg-slate-900 text-slate-200">
  <!-- Header with navigation -->
  <header class="bg-slate-800 shadow-lg sticky top-0 z-10">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <a href="/" class="text-2xl font-bold text-white flex items-center">
          <span class="text-purple-400 mr-2">UrsaMU</span> Docs
        </a>
        
        <nav class="hidden lg:block">
          <ul class="flex space-x-8">
            
            <li>
              <a href="/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Home</a>
            </li>
            
            <li>
              <a href="/guides/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Guides</a>
            </li>
            
            <li>
              <a href="/configuration/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Configuration</a>
            </li>
            
            <li>
              <a href="/api/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">API Reference</a>
            </li>
            
            <li>
              <a href="/plugins/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Plugins</a>
            </li>
            
            <li>
              <a href="/development/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Development</a>
            </li>
            
          </ul>
        </nav>
        
        <button id="menu-toggle" class="lg:hidden text-white">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden lg:hidden border-t border-slate-700">
      <div class="container mx-auto px-4 py-3">
        <ul class="space-y-3">
          
          <li>
            <a href="/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Home</a>
          </li>
          
          <li>
            <a href="/guides/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Guides</a>
          </li>
          
          <li>
            <a href="/configuration/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Configuration</a>
          </li>
          
          <li>
            <a href="/api/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">API Reference</a>
          </li>
          
          <li>
            <a href="/plugins/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Plugins</a>
          </li>
          
          <li>
            <a href="/development/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Development</a>
          </li>
          
        </ul>
      </div>
    </div>
  </header>

  <!-- Main content area -->
  <div class="container mx-auto px-4 py-8 flex-grow">
    <div class="flex flex-col lg:flex-row lg:gap-12">
      <!-- Sidebar navigation (if available) -->
      
      <aside class="lg:w-72 flex-shrink-0 mb-8 lg:mb-0 order-2 lg:order-1">
        <div class="sticky top-24 bg-slate-800 rounded-lg p-6 shadow-lg">
          <h3 class="text-lg font-semibold mb-4 text-white">On This Page</h3>
          <nav>
            
              <ul class="space-y-3 border-l border-slate-700 pl-4">
                
                <li>
                  <a href="#database-basics" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Database Basics</a>
                </li>
                
                <li>
                  <a href="#database-services" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Database Services</a>
                </li>
                
                <li>
                  <a href="#crud-operations" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">CRUD Operations</a>
                </li>
                
                <li>
                  <a href="#querying-data" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Querying Data</a>
                </li>
                
                <li>
                  <a href="#examples" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Examples</a>
                </li>
                
              </ul>
            
          </nav>
        </div>
      </aside>
      
      
      <!-- Main content -->
      <main class="w-full order-1 lg:order-2 lg:max-w-3xl">
        <article class="prose prose-invert prose-headings:text-white prose-a:text-purple-400 prose-a:no-underline hover:prose-a:text-purple-300 prose-a:transition-colors max-w-none ">
          
          <h1>Using the Database in UrsaMU Plugins</h1>
<p>This guide explains how to use the UrsaMU database system in your plugins to store and retrieve data.</p>
<h2>Database Basics</h2>
<p>UrsaMU uses a simple database system for storing game objects and other data. The database is accessible through several services that provide methods for creating, reading, updating, and deleting data.</p>
<h2>Database Services</h2>
<p>UrsaMU provides several database services for different types of data:</p>
<ul>
<li><strong>dbojs</strong> - The main database for game objects (players, rooms, exits, things)</li>
<li><strong>counters</strong> - A database for counters (used for generating unique IDs)</li>
<li><strong>chans</strong> - A database for communication channels</li>
<li><strong>mail</strong> - A database for the mail system</li>
<li><strong>bboard</strong> - A database for bulletin boards</li>
</ul>
<p>These services are imported from the Database service module:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { dbojs, counters, chans, mail, bboard } from "../../services/Database/index.ts";
</code></pre>
<h2>CRUD Operations</h2>
<p>Each database service provides methods for creating, reading, updating, and deleting data.</p>
<h3>Creating Objects</h3>
<p>To create a new object in the database, use the <code>create</code> method:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Create a new game object
const newObject = {
  flags: "thing",
  data: {
    name: "My Object",
    description: "A custom object created by a plugin"
  }
};

try {
  const obj = await dbojs.create(newObject);
  console.log(`Created object with ID: ${obj.id}`);
} catch (error) {
  console.error("Error creating object:", error);
}
</code></pre>
<h3>Reading Objects</h3>
<p>To retrieve an object from the database, use the <code>get</code> method with the object’s ID:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Get an object by ID
try {
  const obj = await dbojs.get("123");
  if (obj) {
    console.log(`Found object: ${obj.data.name}`);
  } else {
    console.log("Object not found");
  }
} catch (error) {
  console.error("Error getting object:", error);
}
</code></pre>
<h3>Updating Objects</h3>
<p>To update an object in the database, modify the object and use the <code>update</code> method:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Update an object
try {
  const obj = await dbojs.get("123");
  if (obj) {
    // Modify the object
    obj.data.description = "Updated description";
    
    // Save the changes
    await dbojs.update(obj);
    console.log("Object updated");
  }
} catch (error) {
  console.error("Error updating object:", error);
}
</code></pre>
<h3>Deleting Objects</h3>
<p>To delete an object from the database, use the <code>delete</code> method with the object’s ID:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Delete an object
try {
  await dbojs.delete("123");
  console.log("Object deleted");
} catch (error) {
  console.error("Error deleting object:", error);
}
</code></pre>
<h2>Querying Data</h2>
<p>UrsaMU provides a powerful query system for finding objects in the database.</p>
<h3>Basic Queries</h3>
<p>To find objects that match specific criteria, use the <code>query</code> method:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Find all rooms
try {
  const rooms = await dbojs.query({ flags: /room/i });
  console.log(`Found ${rooms.length} rooms`);
} catch (error) {
  console.error("Error querying rooms:", error);
}
</code></pre>
<h3>Complex Queries</h3>
<p>You can create more complex queries by combining multiple criteria:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Find all objects owned by a specific player
try {
  const objects = await dbojs.query({
    owner: "123",
    flags: /thing/i
  });
  console.log(`Found ${objects.length} objects owned by player 123`);
} catch (error) {
  console.error("Error querying objects:", error);
}
</code></pre>
<h3>Querying by Name</h3>
<p>To find objects by name, you can use a regular expression:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Find a player by name (case-insensitive)
try {
  const players = await dbojs.query({
    "data.name": new RegExp("^PlayerName$", "i"),
    flags: /player/i
  });
  
  if (players.length &gt; 0) {
    console.log(`Found player: ${players[0].data.name}`);
  } else {
    console.log("Player not found");
  }
} catch (error) {
  console.error("Error querying player:", error);
}
</code></pre>
<h3>Getting All Objects</h3>
<p>To get all objects in a database, use the <code>all</code> method:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Get all channels
try {
  const channels = await chans.all();
  console.log(`Found ${channels.length} channels`);
} catch (error) {
  console.error("Error getting channels:", error);
}
</code></pre>
<h2>Examples</h2>
<h3>Creating a Room</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { IPlugin } from "../../@types/IPlugin.ts";
import { dbojs, counters } from "../../services/Database/index.ts";

const roomCreatorPlugin: IPlugin = {
  name: "room-creator",
  version: "1.0.0",
  description: "A plugin that creates custom rooms",
  
  init: async () =&gt; {
    try {
      // Get the next object ID
      let counter = await counters.get("objid");
      if (!counter) {
        // Create the counter if it doesn't exist
        counter = await counters.create({
          id: "objid",
          seq: 1
        });
      }
      
      // Increment the counter
      counter.seq += 1;
      await counters.update(counter);
      
      // Create a new room
      const roomId = counter.seq.toString();
      const newRoom = {
        id: roomId,
        flags: "room",
        data: {
          name: "Custom Room",
          description: "A room created by the room-creator plugin."
        }
      };
      
      const room = await dbojs.create(newRoom);
      console.log(`Created room with ID: ${room.id}`);
      
      return true;
    } catch (error) {
      console.error("Error creating room:", error);
      return false;
    }
  },
  
  remove: async () =&gt; {
    try {
      // Find and delete rooms created by this plugin
      const rooms = await dbojs.query({
        "data.name": "Custom Room",
        flags: /room/i
      });
      
      for (const room of rooms) {
        await dbojs.delete(room.id);
        console.log(`Deleted room with ID: ${room.id}`);
      }
    } catch (error) {
      console.error("Error cleaning up rooms:", error);
    }
  }
};

export default roomCreatorPlugin;
</code></pre>
<h3>Creating a Channel</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { IPlugin } from "../../@types/IPlugin.ts";
import { chans } from "../../services/Database/index.ts";

const channelPlugin: IPlugin = {
  name: "channel-plugin",
  version: "1.0.0",
  description: "A plugin that creates a custom channel",
  
  init: async () =&gt; {
    try {
      // Check if the channel already exists
      const existingChannels = await chans.query({ id: "custom" });
      
      if (existingChannels.length === 0) {
        // Create the channel
        await chans.create({
          id: "custom",
          name: "Custom",
          header: "%ch%cg[Custom]%cn",
          alias: "cus",
          lock: "connected"
        });
        
        console.log("Created custom channel");
      } else {
        console.log("Custom channel already exists");
      }
      
      return true;
    } catch (error) {
      console.error("Error creating channel:", error);
      return false;
    }
  },
  
  remove: async () =&gt; {
    try {
      // Delete the custom channel
      await chans.delete("custom");
      console.log("Deleted custom channel");
    } catch (error) {
      console.error("Error deleting channel:", error);
    }
  }
};

export default channelPlugin;
</code></pre>
<h3>Player Inventory System</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { IPlugin } from "../../@types/IPlugin.ts";
import { dbojs } from "../../services/Database/index.ts";
import { registerCommand } from "../../services/Commands/mod.ts";

const inventoryPlugin: IPlugin = {
  name: "inventory",
  version: "1.0.0",
  description: "A plugin that adds an inventory system",
  
  init: async () =&gt; {
    // Register the inventory command
    registerCommand({
      name: "inventory",
      pattern: "inventory/inv/i",
      flags: "connected",
      exec: async (ctx) =&gt; {
        try {
          // Get the player's inventory items
          const items = await dbojs.query({
            location: ctx.player.id,
            flags: /thing/i
          });
          
          if (items.length === 0) {
            ctx.send("You are not carrying anything.");
            return;
          }
          
          // Display the inventory
          let message = "|cYour Inventory:|n\n";
          
          for (const item of items) {
            message += `${item.data.name} - ${item.data.description || "No description"}\n`;
          }
          
          ctx.send(message);
        } catch (error) {
          ctx.send(`Error: ${error.message}`);
        }
      }
    });
    
    // Register the give command
    registerCommand({
      name: "give",
      pattern: "give *",
      flags: "connected",
      exec: async (ctx) =&gt; {
        const args = ctx.args.trim().split("=");
        
        if (args.length !== 2) {
          return ctx.send("Usage: give &lt;item&gt;=&lt;player&gt;");
        }
        
        const itemName = args[0].trim();
        const playerName = args[1].trim();
        
        try {
          // Find the item in the player's inventory
          const items = await dbojs.query({
            location: ctx.player.id,
            "data.name": new RegExp(`^${itemName}$`, "i"),
            flags: /thing/i
          });
          
          if (items.length === 0) {
            return ctx.send(`You don't have '${itemName}'.`);
          }
          
          const item = items[0];
          
          // Find the target player
          const players = await dbojs.query({
            "data.name": new RegExp(`^${playerName}$`, "i"),
            flags: /player/i
          });
          
          if (players.length === 0) {
            return ctx.send(`Player '${playerName}' not found.`);
          }
          
          const targetPlayer = players[0];
          
          // Move the item to the target player
          item.location = targetPlayer.id;
          await dbojs.update(item);
          
          ctx.send(`You give ${item.data.name} to ${targetPlayer.data.name}.`);
        } catch (error) {
          ctx.send(`Error: ${error.message}`);
        }
      }
    });
    
    return true;
  }
};

export default inventoryPlugin;
</code></pre>
<p>By following these guidelines and examples, you can effectively use the UrsaMU database system in your plugins to store and retrieve data.</p>

        </article>
      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-slate-800 py-8 mt-12 border-t border-slate-700">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <p>© UrsaMU Team - <a href="https://github.com/lcanady/ursamu" class="text-purple-400 hover:text-purple-300 transition-colors">GitHub Repository</a></p>
        </div>
        <div>
          <p>Built with <a href="https://lume.land" class="text-purple-400 hover:text-purple-300 transition-colors">Lume</a> for <a href="https://deno.land" class="text-purple-400 hover:text-purple-300 transition-colors">Deno</a></p>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    document.getElementById('menu-toggle').addEventListener('click', function() {
      document.getElementById('mobile-menu').classList.toggle('hidden');
    });

    // Smooth scrolling for anchor links
    document.addEventListener('DOMContentLoaded', function() {
      // Add IDs to headings if they don't have them
      const article = document.querySelector('article');
      if (article) {
        const headings = article.querySelectorAll('h2, h3, h4, h5, h6');
        headings.forEach(heading => {
          if (!heading.id) {
            // Create ID from heading text
            const id = heading.textContent
              .toLowerCase()
              .replace(/[^\w\s-]/g, '')
              .replace(/[\s_-]+/g, '-')
              .replace(/^-+|-+$/g, '');
            heading.id = id;
          }
        });
      }
      
      // Get all links that have hash (#) in them
      const anchorLinks = document.querySelectorAll('a[href^="#"]');
      
      // Add click event listener to each anchor link
      anchorLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          // Prevent default jump-to behavior
          e.preventDefault();
          
          // Get the target element
          const targetId = this.getAttribute('href');
          if (targetId === '#') return; // Skip if it's just "#"
          
          const targetElement = document.querySelector(targetId);
          
          if (targetElement) {
            // Calculate header height for offset
            const headerHeight = document.querySelector('header').offsetHeight;
            
            // Get the target's position
            const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
            
            // Scroll to the target with offset for the header
            window.scrollTo({
              top: targetPosition - headerHeight - 20, // 20px extra padding
              behavior: 'smooth'
            });
            
            // Update URL hash without jumping
            history.pushState(null, null, targetId);
          }
        });
      });
    });
  </script>

 </body></html>