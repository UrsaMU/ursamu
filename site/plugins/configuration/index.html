<!DOCTYPE html>
<html lang="en" class="dark"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UrsaMU Documentation</title>
  <meta name="description" content="Learn how to configure UrsaMU plugins and make your plugins configurable">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/prism.css">
  <meta name="theme-color" content="#0f172a">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ursamu.github.io/plugins/configuration/">
<meta name="twitter:card" content="summary">
</head>
<body class="min-h-screen flex flex-col bg-slate-900 text-slate-200">
  <!-- Header with navigation -->
  <header class="bg-slate-800 shadow-lg sticky top-0 z-10">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <a href="/" class="text-2xl font-bold text-white flex items-center">
          <span class="text-purple-400 mr-2">UrsaMU</span> Docs
        </a>
        
        <nav class="hidden lg:block">
          <ul class="flex space-x-8">
            
            <li>
              <a href="/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Home</a>
            </li>
            
            <li>
              <a href="/guides/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Guides</a>
            </li>
            
            <li>
              <a href="/configuration/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Configuration</a>
            </li>
            
            <li>
              <a href="/api/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">API Reference</a>
            </li>
            
            <li>
              <a href="/plugins/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Plugins</a>
            </li>
            
            <li>
              <a href="/development/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Development</a>
            </li>
            
          </ul>
        </nav>
        
        <button id="menu-toggle" class="lg:hidden text-white">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden lg:hidden border-t border-slate-700">
      <div class="container mx-auto px-4 py-3">
        <ul class="space-y-3">
          
          <li>
            <a href="/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Home</a>
          </li>
          
          <li>
            <a href="/guides/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Guides</a>
          </li>
          
          <li>
            <a href="/configuration/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Configuration</a>
          </li>
          
          <li>
            <a href="/api/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">API Reference</a>
          </li>
          
          <li>
            <a href="/plugins/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Plugins</a>
          </li>
          
          <li>
            <a href="/development/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Development</a>
          </li>
          
        </ul>
      </div>
    </div>
  </header>

  <!-- Main content area -->
  <div class="container mx-auto px-4 py-8 flex-grow">
    <div class="flex flex-col lg:flex-row lg:gap-12">
      <!-- Sidebar navigation (if available) -->
      
      <aside class="lg:w-72 flex-shrink-0 mb-8 lg:mb-0 order-2 lg:order-1">
        <div class="sticky top-24 bg-slate-800 rounded-lg p-6 shadow-lg">
          <h3 class="text-lg font-semibold mb-4 text-white">On This Page</h3>
          <nav>
            
              <ul class="space-y-3 border-l border-slate-700 pl-4">
                
                <li>
                  <a href="#plugin-configuration-basics" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Plugin Configuration Basics</a>
                </li>
                
                <li>
                  <a href="#configuration-schema" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Configuration Schema</a>
                </li>
                
                <li>
                  <a href="#accessing-configuration" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Accessing Configuration</a>
                </li>
                
                <li>
                  <a href="#configuration-ui" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Configuration UI</a>
                </li>
                
                <li>
                  <a href="#best-practices" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Best Practices</a>
                </li>
                
                <li>
                  <a href="#examples" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Examples</a>
                </li>
                
              </ul>
            
          </nav>
        </div>
      </aside>
      
      
      <!-- Main content -->
      <main class="w-full order-1 lg:order-2 lg:max-w-3xl">
        <article class="prose prose-invert prose-headings:text-white prose-a:text-purple-400 prose-a:no-underline hover:prose-a:text-purple-300 prose-a:transition-colors max-w-none ">
          
          <h1>Plugin Configuration</h1>
<p>This guide explains how to configure UrsaMU plugins and how to make your own plugins configurable.</p>
<h2>Plugin Configuration Basics</h2>
<p>UrsaMU plugins can define their own configuration options, which can be set in the server’s configuration file. This allows server administrators to customize the behavior of plugins without modifying the plugin code.</p>
<h3>Configuration Location</h3>
<p>Plugin configurations are stored in the main UrsaMU configuration file (<code>config/config.json</code>) under the <code>plugins</code> key:</p>
<pre class="language-json" tabindex="0"><code class="language-json">{
  "server": {
    "port": 4201
  },
  "plugins": {
    "my-plugin": {
      "option1": "value1",
      "option2": 42,
      "nestedOption": {
        "subOption1": true,
        "subOption2": "hello"
      }
    },
    "another-plugin": {
      "enabled": true,
      "timeout": 5000
    }
  }
}
</code></pre>
<h3>Default Configuration</h3>
<p>Plugins should always provide default values for their configuration options. This ensures that the plugin will work correctly even if the administrator doesn’t specify any configuration.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">class MyPlugin implements IPlugin {
  name = "my-plugin";
  version = "1.0.0";
  description = "An example plugin";
  author = "Your Name";
  
  // Default configuration
  config = {
    option1: "default",
    option2: 0,
    nestedOption: {
      subOption1: false,
      subOption2: "default"
    }
  };
  
  // ...
}
</code></pre>
<h2>Configuration Schema</h2>
<p>It’s a good practice to define a TypeScript interface for your plugin’s configuration. This provides type safety and makes it easier to understand what configuration options are available.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Define the configuration interface
interface MyPluginConfig {
  option1: string;
  option2: number;
  nestedOption: {
    subOption1: boolean;
    subOption2: string;
  };
}

class MyPlugin implements IPlugin {
  name = "my-plugin";
  version = "1.0.0";
  description = "An example plugin";
  author = "Your Name";
  
  // Default configuration with type
  config: MyPluginConfig = {
    option1: "default",
    option2: 0,
    nestedOption: {
      subOption1: false,
      subOption2: "default"
    }
  };
  
  // ...
}
</code></pre>
<h3>Configuration Validation</h3>
<p>You can validate the configuration in your plugin’s <code>onInit</code> method to ensure that all required options are present and have valid values:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Validate configuration
  if (typeof this.config.option1 !== 'string') {
    console.error(`[${this.name}] Configuration error: option1 must be a string`);
    // Set a default value
    this.config.option1 = "default";
  }
  
  if (typeof this.config.option2 !== 'number' || this.config.option2 &lt; 0) {
    console.error(`[${this.name}] Configuration error: option2 must be a non-negative number`);
    // Set a default value
    this.config.option2 = 0;
  }
  
  // Continue with initialization
  // ...
}
</code></pre>
<h2>Accessing Configuration</h2>
<h3>In Your Plugin</h3>
<p>You can access your plugin’s configuration through the <code>config</code> property:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Access configuration values
  const option1 = this.config.option1;
  const option2 = this.config.option2;
  
  console.log(`Plugin configured with option1=${option1}, option2=${option2}`);
  
  // Use configuration values
  if (this.config.nestedOption.subOption1) {
    // Do something if subOption1 is true
  }
}
</code></pre>
<h3>Dynamic Configuration</h3>
<p>You can also create methods to access configuration values dynamically:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Get a configuration value with a default fallback
getConfig&lt;T&gt;(key: string, defaultValue: T): T {
  const keys = key.split('.');
  let value: any = this.config;
  
  for (const k of keys) {
    if (value === undefined || value === null) {
      return defaultValue;
    }
    value = value[k];
  }
  
  return value !== undefined ? value : defaultValue;
}

// Example usage
onInit(app: App): void {
  const value1 = this.getConfig('option1', 'fallback');
  const value2 = this.getConfig('nestedOption.subOption1', false);
  
  console.log(`Values: ${value1}, ${value2}`);
}
</code></pre>
<h2>Configuration UI</h2>
<p>For more complex plugins, you might want to provide a web-based configuration UI. UrsaMU provides hooks to add configuration pages to the admin interface.</p>
<h3>Registering a Configuration Page</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Register a configuration page
  app.admin.registerConfigPage({
    plugin: this.name,
    title: "My Plugin Settings",
    description: "Configure the My Plugin settings",
    route: "/admin/config/my-plugin",
    component: "MyPluginConfig", // Name of your component
    order: 100 // Display order in the menu
  });
  
  // Register the component
  app.admin.registerComponent("MyPluginConfig", {
    template: `
      &lt;div class="config-page"&gt;
        &lt;h1&gt;My Plugin Configuration&lt;/h1&gt;
        &lt;form @submit.prevent="saveConfig"&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="option1"&gt;Option 1&lt;/label&gt;
            &lt;input type="text" id="option1" v-model="config.option1"&gt;
          &lt;/div&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="option2"&gt;Option 2&lt;/label&gt;
            &lt;input type="number" id="option2" v-model="config.option2"&gt;
          &lt;/div&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="subOption1"&gt;Sub Option 1&lt;/label&gt;
            &lt;input type="checkbox" id="subOption1" v-model="config.nestedOption.subOption1"&gt;
          &lt;/div&gt;
          &lt;div class="form-group"&gt;
            &lt;label for="subOption2"&gt;Sub Option 2&lt;/label&gt;
            &lt;input type="text" id="subOption2" v-model="config.nestedOption.subOption2"&gt;
          &lt;/div&gt;
          &lt;button type="submit" class="btn btn-primary"&gt;Save&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    `,
    data() {
      return {
        config: JSON.parse(JSON.stringify(app.config.plugins[this.name] || {}))
      };
    },
    methods: {
      async saveConfig() {
        try {
          await app.config.setPluginConfig(this.name, this.config);
          app.admin.showNotification("Configuration saved successfully", "success");
        } catch (error) {
          app.admin.showNotification(`Error saving configuration: ${error.message}`, "error");
        }
      }
    }
  });
}
</code></pre>
<h2>Best Practices</h2>
<h3>Configuration Naming</h3>
<p>Use clear, descriptive names for your configuration options. Avoid abbreviations and use camelCase for consistency.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// Good
config = {
  maxPlayers: 100,
  defaultWelcomeMessage: "Welcome to the game!",
  enableAdvancedFeatures: false
};

// Bad
config = {
  max_plrs: 100,
  def_msg: "Welcome to the game!",
  adv: false
};
</code></pre>
<h3>Documentation</h3>
<p>Document your configuration options thoroughly, both in your code and in your plugin’s documentation. Include:</p>
<ul>
<li>What each option does</li>
<li>The expected type and format</li>
<li>Any constraints (min/max values, allowed strings, etc.)</li>
<li>The default value</li>
</ul>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">/**
 * Configuration for the MyPlugin plugin.
 * 
 * @property {string} option1 - Description of option1. Default: "default"
 * @property {number} option2 - Description of option2. Must be &gt;= 0. Default: 0
 * @property {Object} nestedOption - Nested configuration options
 * @property {boolean} nestedOption.subOption1 - Description of subOption1. Default: false
 * @property {string} nestedOption.subOption2 - Description of subOption2. Default: "default"
 */
config = {
  option1: "default",
  option2: 0,
  nestedOption: {
    subOption1: false,
    subOption2: "default"
  }
};
</code></pre>
<h3>Sensitive Information</h3>
<p>Avoid storing sensitive information (like API keys, passwords, etc.) directly in the configuration. Instead, use environment variables or a separate secure storage mechanism.</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Get API key from environment variable, with config as fallback
  this.apiKey = Deno.env.get("MY_PLUGIN_API_KEY") || this.config.apiKey;
  
  if (!this.apiKey) {
    console.error(`[${this.name}] No API key provided. Plugin will not function correctly.`);
  }
}
</code></pre>
<h3>Configuration Changes</h3>
<p>If your plugin needs to respond to configuration changes at runtime, you can register a hook for the <code>config:change</code> event:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">onInit(app: App): void {
  // Register a hook for configuration changes
  app.hooks.on('config:change', (data) =&gt; {
    if (data.plugin === this.name) {
      console.log(`Configuration for ${this.name} changed`);
      // Update internal state based on new configuration
      this.updateInternalState();
    }
  });
}

updateInternalState(): void {
  // Update any internal state that depends on configuration
  this.someFeatureEnabled = this.config.enableSomeFeature;
  
  // Restart services if needed
  if (this.service) {
    this.service.stop();
    this.service.start(this.config.serviceOptions);
  }
}
</code></pre>
<h2>Examples</h2>
<h3>Simple Plugin Configuration</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin } from "ursamu";

interface GreeterConfig {
  message: string;
  showTimestamp: boolean;
  delay: number;
}

export default class GreeterPlugin implements IPlugin {
  name = "greeter";
  version = "1.0.0";
  description = "Greets players when they connect";
  author = "Your Name";
  
  config: GreeterConfig = {
    message: "Welcome to the game!",
    showTimestamp: true,
    delay: 1000
  };
  
  private connectHandler: (player: any) =&gt; void;
  
  onInit(app: App): void {
    this.connectHandler = (player) =&gt; {
      setTimeout(() =&gt; {
        let greeting = this.config.message;
        
        if (this.config.showTimestamp) {
          const timestamp = new Date().toLocaleTimeString();
          greeting = `[${timestamp}] ${greeting}`;
        }
        
        player.send(`|c${greeting}|n`);
      }, this.config.delay);
    };
    
    app.hooks.on('player:connect', this.connectHandler);
    
    console.log(`${this.name} initialized with message: "${this.config.message}"`);
  }
  
  onLoad(app: App): void {
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    app.hooks.off('player:connect', this.connectHandler);
    console.log(`${this.name} unloaded`);
  }
}
</code></pre>
<h3>Complex Plugin Configuration</h3>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { App, IPlugin } from "ursamu";

interface DiscordIntegrationConfig {
  enabled: boolean;
  token: string;
  channels: {
    general: string;
    announcements: string;
    admin: string;
  };
  prefix: string;
  syncRoles: boolean;
  roleMapping: Record&lt;string, string&gt;;
  messageOptions: {
    showPlayerName: boolean;
    showTimestamp: boolean;
    embedColor: string;
  };
}

export default class DiscordIntegrationPlugin implements IPlugin {
  name = "discord-integration";
  version = "1.0.0";
  description = "Integrates UrsaMU with Discord";
  author = "Your Name";
  
  config: DiscordIntegrationConfig = {
    enabled: false,
    token: "",
    channels: {
      general: "",
      announcements: "",
      admin: ""
    },
    prefix: "!",
    syncRoles: false,
    roleMapping: {},
    messageOptions: {
      showPlayerName: true,
      showTimestamp: true,
      embedColor: "#0099ff"
    }
  };
  
  private client: any = null;
  
  onInit(app: App): void {
    // Validate configuration
    if (this.config.enabled) {
      if (!this.config.token) {
        console.error(`[${this.name}] Discord token is required when enabled`);
        this.config.enabled = false;
      }
      
      if (!this.config.channels.general) {
        console.error(`[${this.name}] General channel ID is required`);
        this.config.enabled = false;
      }
    }
    
    // Register commands
    app.commands.register("discord-integration", {
      name: "discord",
      pattern: "discord *",
      flags: "connected",
      exec: (ctx) =&gt; {
        const args = ctx.args.trim();
        
        if (!args) {
          return ctx.send(`
            |cDiscord Integration Help|n
            discord status - Show Discord connection status
            discord link - Link your Discord account
            discord unlink - Unlink your Discord account
          `);
        }
        
        if (args === "status") {
          const status = this.client ? "connected" : "disconnected";
          ctx.send(`Discord integration is ${this.config.enabled ? 'enabled' : 'disabled'} and ${status}.`);
        }
        
        // Other command handlers...
      }
    });
    
    console.log(`${this.name} initialized`);
  }
  
  onLoad(app: App): void {
    if (this.config.enabled) {
      this.startDiscordClient(app);
    }
    
    console.log(`${this.name} v${this.version} loaded!`);
  }
  
  onUnload(app: App): void {
    if (this.client) {
      this.client.destroy();
      this.client = null;
    }
    
    console.log(`${this.name} unloaded`);
  }
  
  startDiscordClient(app: App): void {
    // Implementation of Discord client initialization
    console.log(`Starting Discord client with token: ${this.config.token.substring(0, 5)}...`);
    
    // In a real implementation, you would initialize the Discord.js client here
    this.client = {
      destroy: () =&gt; console.log("Discord client destroyed")
    };
    
    // Register hooks for sending messages to Discord
    app.hooks.on('channel:message', (data) =&gt; {
      if (this.config.enabled &amp;&amp; this.client) {
        // Send channel messages to Discord
        console.log(`Would send message to Discord: ${data.message}`);
      }
    });
  }
}
</code></pre>
<p>By following these guidelines, you can create plugins with flexible, well-documented configuration options that make your plugins more useful and adaptable to different UrsaMU installations.</p>

        </article>
      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-slate-800 py-8 mt-12 border-t border-slate-700">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <p>© UrsaMU Team - <a href="https://github.com/lcanady/ursamu" class="text-purple-400 hover:text-purple-300 transition-colors">GitHub Repository</a></p>
        </div>
        <div>
          <p>Built with <a href="https://lume.land" class="text-purple-400 hover:text-purple-300 transition-colors">Lume</a> for <a href="https://deno.land" class="text-purple-400 hover:text-purple-300 transition-colors">Deno</a></p>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    document.getElementById('menu-toggle').addEventListener('click', function() {
      document.getElementById('mobile-menu').classList.toggle('hidden');
    });

    // Smooth scrolling for anchor links
    document.addEventListener('DOMContentLoaded', function() {
      // Add IDs to headings if they don't have them
      const article = document.querySelector('article');
      if (article) {
        const headings = article.querySelectorAll('h2, h3, h4, h5, h6');
        headings.forEach(heading => {
          if (!heading.id) {
            // Create ID from heading text
            const id = heading.textContent
              .toLowerCase()
              .replace(/[^\w\s-]/g, '')
              .replace(/[\s_-]+/g, '-')
              .replace(/^-+|-+$/g, '');
            heading.id = id;
          }
        });
      }
      
      // Get all links that have hash (#) in them
      const anchorLinks = document.querySelectorAll('a[href^="#"]');
      
      // Add click event listener to each anchor link
      anchorLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          // Prevent default jump-to behavior
          e.preventDefault();
          
          // Get the target element
          const targetId = this.getAttribute('href');
          if (targetId === '#') return; // Skip if it's just "#"
          
          const targetElement = document.querySelector(targetId);
          
          if (targetElement) {
            // Calculate header height for offset
            const headerHeight = document.querySelector('header').offsetHeight;
            
            // Get the target's position
            const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
            
            // Scroll to the target with offset for the header
            window.scrollTo({
              top: targetPosition - headerHeight - 20, // 20px extra padding
              behavior: 'smooth'
            });
            
            // Update URL hash without jumping
            history.pushState(null, null, targetId);
          }
        });
      });
    });
  </script>

 </body></html>