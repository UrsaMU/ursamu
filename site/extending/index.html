<!DOCTYPE html>
<html lang="en" class="dark"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UrsaMU Documentation</title>
  <meta name="description" content="Learn how to extend UrsaMU with custom functionality">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/prism.css">
  <meta name="theme-color" content="#0f172a">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ursamu.github.io/extending/">
<meta name="twitter:card" content="summary">
</head>
<body class="min-h-screen flex flex-col bg-slate-900 text-slate-200">
  <!-- Header with navigation -->
  <header class="bg-slate-800 shadow-lg sticky top-0 z-10">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <a href="/" class="text-2xl font-bold text-white flex items-center">
          <span class="text-purple-400 mr-2">UrsaMU</span> Docs
        </a>
        
        <nav class="hidden lg:block">
          <ul class="flex space-x-8">
            
            <li>
              <a href="/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Home</a>
            </li>
            
            <li>
              <a href="/guides/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Guides</a>
            </li>
            
            <li>
              <a href="/configuration/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Configuration</a>
            </li>
            
            <li>
              <a href="/api/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">API Reference</a>
            </li>
            
            <li>
              <a href="/plugins/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Plugins</a>
            </li>
            
            <li>
              <a href="/development/" class="text-slate-300 hover:text-purple-300 transition-colors py-2">Development</a>
            </li>
            
          </ul>
        </nav>
        
        <button id="menu-toggle" class="lg:hidden text-white">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden lg:hidden border-t border-slate-700">
      <div class="container mx-auto px-4 py-3">
        <ul class="space-y-3">
          
          <li>
            <a href="/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Home</a>
          </li>
          
          <li>
            <a href="/guides/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Guides</a>
          </li>
          
          <li>
            <a href="/configuration/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Configuration</a>
          </li>
          
          <li>
            <a href="/api/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">API Reference</a>
          </li>
          
          <li>
            <a href="/plugins/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Plugins</a>
          </li>
          
          <li>
            <a href="/development/" class="block py-2 text-slate-300 hover:text-purple-300 transition-colors">Development</a>
          </li>
          
        </ul>
      </div>
    </div>
  </header>

  <!-- Main content area -->
  <div class="container mx-auto px-4 py-8 flex-grow">
    <div class="flex flex-col lg:flex-row lg:gap-12">
      <!-- Sidebar navigation (if available) -->
      
      <aside class="lg:w-72 flex-shrink-0 mb-8 lg:mb-0 order-2 lg:order-1">
        <div class="sticky top-24 bg-slate-800 rounded-lg p-6 shadow-lg">
          <h3 class="text-lg font-semibold mb-4 text-white">On This Page</h3>
          <nav>
            
              <ul class="space-y-3 border-l border-slate-700 pl-4">
                
                <li>
                  <a href="#overview" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Overview</a>
                </li>
                
                <li>
                  <a href="#extension-points" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Extension Points</a>
                </li>
                
                <li>
                  <a href="#custom-commands" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Custom Commands</a>
                </li>
                
                <li>
                  <a href="#custom-flags" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Custom Flags</a>
                </li>
                
                <li>
                  <a href="#custom-functions" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Custom Functions</a>
                </li>
                
                <li>
                  <a href="#custom-hooks" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Custom Hooks</a>
                </li>
                
                <li>
                  <a href="#advanced-extensions" class="block py-1 text-purple-400 hover:text-purple-300 transition-colors">Advanced Extensions</a>
                </li>
                
              </ul>
            
          </nav>
        </div>
      </aside>
      
      
      <!-- Main content -->
      <main class="w-full order-1 lg:order-2 lg:max-w-3xl">
        <article class="prose prose-invert prose-headings:text-white prose-a:text-purple-400 prose-a:no-underline hover:prose-a:text-purple-300 prose-a:transition-colors max-w-none ">
          
          <h1>Extending UrsaMU</h1>
<p>This guide explains how to extend UrsaMU with custom functionality beyond what plugins provide.</p>
<h2>Overview</h2>
<p>UrsaMU is designed to be highly extensible. While plugins are the primary way to add functionality, there are several other extension points that allow you to customize the system at a deeper level.</p>
<p>Extension points include:</p>
<ul>
<li>Custom commands</li>
<li>Custom flags</li>
<li>Custom functions</li>
<li>Custom hooks</li>
<li>Advanced extensions (middleware, services, etc.)</li>
</ul>
<h2>Extension Points</h2>
<h3>When to Use Extensions vs. Plugins</h3>
<ul>
<li><strong>Plugins</strong>: Use plugins for self-contained features that can be enabled or disabled as a unit.</li>
<li><strong>Extensions</strong>: Use extensions when you need to modify core behavior or add functionality that integrates deeply with the system.</li>
</ul>
<p>Extensions are typically implemented within plugins but can also be added directly in a child game.</p>
<h2>Custom Commands</h2>
<p>Commands are the primary way players interact with UrsaMU. You can create custom commands to add new functionality.</p>
<h3>Registering Commands</h3>
<p>Use the <code>registerCommand</code> function to register a new command:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { registerCommand } from "../../services/Commands/mod.ts";

registerCommand({
  name: "mycommand",       // Unique identifier for the command
  pattern: "mycommand *",  // Pattern to match user input
  flags: "connected",      // Flags required to use the command
  exec: (ctx) =&gt; {         // Function to execute when command is triggered
    const args = ctx.args.trim();
    ctx.send(`You typed: ${args}`);
  }
});
</code></pre>
<h3>Command Context</h3>
<p>The <code>ctx</code> object passed to the <code>exec</code> function contains:</p>
<ul>
<li><code>player</code>: The player who triggered the command</li>
<li><code>cmd</code>: The command that was triggered</li>
<li><code>args</code>: The arguments passed to the command</li>
<li><code>switches</code>: Any switches used with the command</li>
<li><code>send</code>: Function to send output to the player</li>
</ul>
<h3>Command Patterns</h3>
<p>Command patterns determine when a command is triggered:</p>
<ul>
<li>Exact match: <code>"look"</code> - Matches only “look”</li>
<li>Wildcard: <code>"look *"</code> - Matches “look” followed by anything</li>
<li>Multiple patterns: <code>"look/l"</code> - Matches either “look” or “l”</li>
<li>Regex: <code>"^l(.*)$"</code> - Uses a regular expression to match</li>
</ul>
<h2>Custom Flags</h2>
<p>Flags are used to control access to commands and features. You can create custom flags to implement your own permission system.</p>
<h3>Registering Flags</h3>
<p>Use the <code>registerFlag</code> function to register a new flag:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { registerFlag } from "../../services/Flags/mod.ts";

registerFlag({
  name: "myflag",          // Name of the flag
  description: "My custom flag", // Description of what the flag does
  default: false           // Default value for new objects
});
</code></pre>
<h3>Checking Flags</h3>
<p>Use the <code>hasFlag</code> function to check if an object has a flag:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { hasFlag } from "../../services/Flags/mod.ts";

// Check if player has the "myflag" flag
if (hasFlag(player, "myflag")) {
  // Do something
}
</code></pre>
<h3>Setting Flags</h3>
<p>Use the <code>setFlag</code> function to set a flag on an object:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { setFlag } from "../../services/Flags/mod.ts";

// Set the "myflag" flag on a player
await setFlag(player, "myflag", true);
</code></pre>
<h2>Custom Functions</h2>
<p>Functions are used in expressions and can be called from commands. You can create custom functions to add new capabilities to the expression system.</p>
<h3>Registering Functions</h3>
<p>Use the <code>registerFunction</code> function to register a new function:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { registerFunction } from "../../services/Functions/mod.ts";

registerFunction({
  name: "myfunc",          // Name of the function
  description: "My custom function", // Description of what the function does
  args: ["arg1", "?arg2"],  // Arguments (? prefix means optional)
  exec: (args, ctx) =&gt; {    // Function to execute
    const [arg1, arg2 = "default"] = args;
    return `${arg1} and ${arg2}`;
  }
});
</code></pre>
<h3>Using Custom Functions</h3>
<p>Once registered, your function can be used in expressions:</p>
<pre class="language-none" tabindex="0"><code class="language-none">&gt; think myfunc(hello, world)
hello and world
</code></pre>
<h2>Custom Hooks</h2>
<p>Hooks allow you to run code at specific points in the system’s execution. You can create custom hooks to add behavior that runs automatically.</p>
<h3>Registering Hooks</h3>
<p>Use the <code>registerHook</code> function to register a new hook:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { registerHook } from "../../services/Hooks/mod.ts";

// Register a hook that runs when a player connects
registerHook("playerConnect", async (player) =&gt; {
  console.log(`Player ${player.data.name} connected`);
  
  // You can modify the player or perform other actions
  player.data.lastLogin = new Date().toISOString();
  await dbojs.update(player);
});
</code></pre>
<h3>Available Hook Points</h3>
<p>UrsaMU provides several hook points:</p>
<ul>
<li><code>playerConnect</code>: Triggered when a player connects</li>
<li><code>playerDisconnect</code>: Triggered when a player disconnects</li>
<li><code>playerCreate</code>: Triggered when a player is created</li>
<li><code>commandBefore</code>: Triggered before a command is executed</li>
<li><code>commandAfter</code>: Triggered after a command is executed</li>
<li><code>objectCreate</code>: Triggered when an object is created</li>
<li><code>objectDestroy</code>: Triggered when an object is destroyed</li>
</ul>
<h3>Creating Custom Hook Points</h3>
<p>You can create your own hook points for plugins to use:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { registerHookPoint, triggerHook } from "../../services/Hooks/mod.ts";

// Register a new hook point
registerHookPoint("myCustomHook");

// Trigger the hook somewhere in your code
await triggerHook("myCustomHook", { data: "some data" });
</code></pre>
<h2>Advanced Extensions</h2>
<h3>Custom Middleware</h3>
<p>You can create custom middleware to process commands before they’re executed:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { registerMiddleware } from "../../services/Commands/mod.ts";

// Register middleware that logs all commands
registerMiddleware(async (ctx, next) =&gt; {
  console.log(`Player ${ctx.player.data.name} executed: ${ctx.cmd} ${ctx.args}`);
  
  // Call the next middleware in the chain
  await next();
  
  console.log("Command execution completed");
});
</code></pre>
<h3>Custom Services</h3>
<p>You can create custom services to provide functionality to other parts of the system:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">// src/services/MyService/mod.ts
class MyService {
  private data: Map&lt;string, any&gt; = new Map();
  
  constructor() {
    console.log("MyService initialized");
  }
  
  set(key: string, value: any): void {
    this.data.set(key, value);
  }
  
  get(key: string): any {
    return this.data.get(key);
  }
}

// Create a singleton instance
export const myService = new MyService();
</code></pre>
<h3>Custom Database Models</h3>
<p>You can create custom database models to store specialized data:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { dbojs } from "../../services/Database/index.ts";

// Define a type for your model
interface MyModel {
  id: string;
  name: string;
  data: Record&lt;string, any&gt;;
}

// Create functions to work with your model
async function createMyModel(data: Omit&lt;MyModel, "id"&gt;): Promise&lt;MyModel&gt; {
  const model = await dbojs.create({
    flags: "mymodel",
    data: {
      name: data.name,
      ...data.data
    }
  });
  
  return {
    id: model.id,
    name: data.name,
    data: data.data
  };
}

async function getMyModels(): Promise&lt;MyModel[]&gt; {
  const models = await dbojs.query({ flags: /mymodel/i });
  
  return models.map(model =&gt; ({
    id: model.id,
    name: model.data.name,
    data: { ...model.data }
  }));
}
</code></pre>
<h3>Custom Web Routes</h3>
<p>If you’re using the web interface, you can add custom routes:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { app } from "../../app.ts";

// Add a custom API endpoint
app.router.get("/api/custom", (ctx) =&gt; {
  ctx.response.body = { message: "Custom API endpoint" };
});

// Add a custom page
app.router.get("/custom", async (ctx) =&gt; {
  ctx.response.body = await app.render("custom.html", {
    title: "Custom Page",
    data: { /* your data */ }
  });
});
</code></pre>
<h3>Example: Complete Extension</h3>
<p>Here’s an example of a plugin that uses multiple extension points:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import { IPlugin } from "../../@types/IPlugin.ts";
import { registerCommand } from "../../services/Commands/mod.ts";
import { registerFlag } from "../../services/Flags/mod.ts";
import { registerFunction } from "../../services/Functions/mod.ts";
import { registerHook } from "../../services/Hooks/mod.ts";
import { dbojs } from "../../services/Database/index.ts";

const myExtensionPlugin: IPlugin = {
  name: "my-extension",
  version: "1.0.0",
  description: "A plugin that demonstrates various extension points",
  
  init: async () =&gt; {
    // Register a custom flag
    registerFlag({
      name: "vip",
      description: "VIP player with special privileges",
      default: false
    });
    
    // Register a custom function
    registerFunction({
      name: "isvip",
      description: "Check if a player is a VIP",
      args: ["player"],
      exec: async (args, ctx) =&gt; {
        const [playerName] = args;
        
        // Find the player
        const players = await dbojs.query({
          "data.name": new RegExp(`^${playerName}$`, "i"),
          flags: /player/i
        });
        
        if (players.length === 0) {
          return "0";
        }
        
        // Check if the player has the VIP flag
        return players[0].flags.includes("vip") ? "1" : "0";
      }
    });
    
    // Register a custom command
    registerCommand({
      name: "vip",
      pattern: "vip *",
      flags: "wizard",
      exec: async (ctx) =&gt; {
        const args = ctx.args.trim().split(" ");
        const action = args[0];
        const target = args[1];
        
        if (!action || !target) {
          return ctx.send("Usage: vip add/remove &lt;player&gt;");
        }
        
        // Find the target player
        const players = await dbojs.query({
          "data.name": new RegExp(`^${target}$`, "i"),
          flags: /player/i
        });
        
        if (players.length === 0) {
          return ctx.send(`Player '${target}' not found.`);
        }
        
        const player = players[0];
        
        if (action === "add") {
          // Add the VIP flag
          if (!player.flags.includes("vip")) {
            player.flags.push("vip");
            await dbojs.update(player);
            ctx.send(`Added VIP status to ${player.data.name}.`);
          } else {
            ctx.send(`${player.data.name} is already a VIP.`);
          }
        } else if (action === "remove") {
          // Remove the VIP flag
          if (player.flags.includes("vip")) {
            player.flags = player.flags.filter(f =&gt; f !== "vip");
            await dbojs.update(player);
            ctx.send(`Removed VIP status from ${player.data.name}.`);
          } else {
            ctx.send(`${player.data.name} is not a VIP.`);
          }
        } else {
          ctx.send("Usage: vip add/remove &lt;player&gt;");
        }
      }
    });
    
    // Register a hook
    registerHook("playerConnect", async (player) =&gt; {
      // Check if the player is a VIP
      if (player.flags.includes("vip")) {
        // Broadcast a message to all connected players
        const connectedPlayers = await dbojs.query({
          flags: /connected/i
        });
        
        for (const p of connectedPlayers) {
          p.send(`VIP player ${player.data.name} has connected!`);
        }
      }
    });
    
    return true;
  },
  
  remove: async () =&gt; {
    // Cleanup code here
  }
};

export default myExtensionPlugin;
</code></pre>
<p>By using these extension points, you can deeply customize UrsaMU to create a unique game experience tailored to your needs.</p>

        </article>
      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-slate-800 py-8 mt-12 border-t border-slate-700">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <p>© UrsaMU Team - <a href="https://github.com/lcanady/ursamu" class="text-purple-400 hover:text-purple-300 transition-colors">GitHub Repository</a></p>
        </div>
        <div>
          <p>Built with <a href="https://lume.land" class="text-purple-400 hover:text-purple-300 transition-colors">Lume</a> for <a href="https://deno.land" class="text-purple-400 hover:text-purple-300 transition-colors">Deno</a></p>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    document.getElementById('menu-toggle').addEventListener('click', function() {
      document.getElementById('mobile-menu').classList.toggle('hidden');
    });

    // Smooth scrolling for anchor links
    document.addEventListener('DOMContentLoaded', function() {
      // Add IDs to headings if they don't have them
      const article = document.querySelector('article');
      if (article) {
        const headings = article.querySelectorAll('h2, h3, h4, h5, h6');
        headings.forEach(heading => {
          if (!heading.id) {
            // Create ID from heading text
            const id = heading.textContent
              .toLowerCase()
              .replace(/[^\w\s-]/g, '')
              .replace(/[\s_-]+/g, '-')
              .replace(/^-+|-+$/g, '');
            heading.id = id;
          }
        });
      }
      
      // Get all links that have hash (#) in them
      const anchorLinks = document.querySelectorAll('a[href^="#"]');
      
      // Add click event listener to each anchor link
      anchorLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          // Prevent default jump-to behavior
          e.preventDefault();
          
          // Get the target element
          const targetId = this.getAttribute('href');
          if (targetId === '#') return; // Skip if it's just "#"
          
          const targetElement = document.querySelector(targetId);
          
          if (targetElement) {
            // Calculate header height for offset
            const headerHeight = document.querySelector('header').offsetHeight;
            
            // Get the target's position
            const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
            
            // Scroll to the target with offset for the header
            window.scrollTo({
              top: targetPosition - headerHeight - 20, // 20px extra padding
              behavior: 'smooth'
            });
            
            // Update URL hash without jumping
            history.pushState(null, null, targetId);
          }
        });
      });
    });
  </script>

 </body></html>